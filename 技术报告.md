### **基于 NLP 的安全日志分析与异常检测 - 技术报告**  

---

## **1. 项目概述**  
### **1.1 背景**  
本项目旨在利用 **自然语言处理（NLP）** 技术，构建一个**智能安全日志分析系统**，可以自动解析日志、提供自然语言查询、检测异常并生成告警，以减少安全分析人员的工作量，提高检测效率。  

### **1.2 目标**
- **日志解析**（从文本提取结构化信息）  
- **自然语言查询**（用户用普通语言搜索日志，无需 SQL）  
- **异常检测**（发现暴力破解、异常 IP 登录等安全事件）  
- **Web 界面**（支持日志上传、查询、简单可视化）  

---

## **2. 技术架构**
### **2.1 选用技术**
| **组件** | **技术选型** |
|----------|-------------|
| **前端** | HTML + Bootstrap + jQuery（简洁易用） |
| **后端** | Flask（轻量级 Web 框架） |
| **数据库** | SQLite（易于部署） |
| **日志解析** | Python + regex + spaCy |
| **自然语言查询** | GPT-4 / 规则匹配 |
| **异常检测** | 规则匹配 + 机器学习（逻辑回归） |

### **2.2 系统架构**
```
+------------------------------+
|        Web 前端（Bootstrap）  |
+------------------------------+
        |  用户查询 / 日志上传
        v
+------------------------------+
|        Flask API 服务器      |
+------------------------------+
        |   API 调用
        v
+------------------------------+
|         SQLite 数据库        |
+------------------------------+
        |  读取 / 存储
        v
+------------------------------+
|   NLP 处理 & 异常检测模块   |
+------------------------------+
```

---

## **3. API 设计**
### **3.1 API 总览**
| **模块** | **API** | **功能** |
|----------|---------|----------|
| **日志管理** | `POST /upload_log` | 上传日志文件 |
| **日志查询** | `GET /query_log` | 通过 SQL 查询日志 |
| **自然语言查询** | `POST /nlp_query` | NLP 解析查询语句，转换为 SQL |
| **异常检测** | `GET /detect_anomaly` | 执行异常检测，并返回可疑日志 |
| **告警系统** | `GET /get_alerts` | 获取最近的安全告警 |
| **Web 前端支持** | `GET /dashboard_data` | 获取统计数据 |

---

### **3.2 API 详细设计**
#### **📌 3.2.1 日志管理 API**
✅ **上传日志**
- **URL**：`POST /upload_log`
- **参数**：
  ```json
  {
    "log_content": "2025-03-24 12:34:56 - User 'admin' login failed from 192.168.1.100"
  }
  ```
- **返回**
  ```json
  {
    "status": "success",
    "message": "Log uploaded successfully"
  }
  ```

---

#### **📌 3.2.2 日志查询 API**
✅ **查询日志**
- **URL**：`GET /query_log`
- **参数**
  ```
  ?username=admin&event=login_failed
  ```
- **返回**
  ```json
  [
    {
      "timestamp": "2025-03-24 12:34:56",
      "username": "admin",
      "event": "login_failed",
      "ip_address": "192.168.1.100"
    }
  ]
  ```

---

#### **📌 3.2.3 自然语言查询 API**
✅ **解析自然语言查询**
- **URL**：`POST /nlp_query`
- **参数**
  ```json
  {
    "query": "过去 24 小时 admin 登录失败次数"
  }
  ```
- **返回**
  ```json
  {
    "sql": "SELECT COUNT(*) FROM logs WHERE username='admin' AND event='login_failed' AND timestamp >= datetime('now', '-1 day');",
    "result": "过去 24 小时内，admin 登录失败 34 次，涉及 5 个不同 IP。"
  }
  ```

---

#### **📌 3.2.4 异常检测 API**
✅ **执行异常检测**
- **URL**：`GET /detect_anomaly`
- **返回**
  ```json
  {
    "anomalies": [
      {
        "timestamp": "2025-03-24 12:34:56",
        "username": "admin",
        "event": "login_failed",
        "ip_address": "192.168.1.100",
        "reason": "Possible brute-force attack (50 failed attempts in 5 minutes)"
      }
    ]
  }
  ```

---

## **4. 数据库设计**
### **4.1 表结构**
#### **日志表（logs）**
| **字段** | **类型** | **描述** |
|----------|---------|----------|
| `id` | INTEGER (PK) | 日志 ID |
| `timestamp` | TEXT | 事件时间 |
| `username` | TEXT | 用户名 |
| `event` | TEXT | 事件类型 |
| `ip_address` | TEXT | 登录 IP |

#### **异常检测表（anomalies）**
| **字段** | **类型** | **描述** |
|----------|---------|----------|
| `id` | INTEGER (PK) | 异常 ID |
| `timestamp` | TEXT | 发生时间 |
| `username` | TEXT | 受影响的用户 |
| `event` | TEXT | 事件类型 |
| `ip_address` | TEXT | 登录 IP |
| `reason` | TEXT | 触发异常检测的原因 |

---

## **5. 5 人团队分工**
| **角色** | **主要任务** | **技术栈** |
|----------|------------|----------|
| **前端开发（A）** | Web UI（日志查询界面、可视化仪表盘） | HTML / Bootstrap / JavaScript |
| **后端开发（B）** | Flask API（日志存储、查询） | Flask / SQLite |
| **后端开发（C）** | Flask API（异常检测、告警） | Flask / ML 规则匹配 |
| **AI/NLP 工程师（D）** | 训练 NLP（自然语言查询转换 SQL） | GPT-4 / spaCy |
| **全栈开发（E）** | 代码集成、测试、优化 | Python / Flask |

---

## **6. 结论**
✅ **基础版 MVP 目标**
- **日志解析**
- **自然语言查询**
- **异常检测**
- **Web UI 展示**

✅ **易拓展高级功能**
- **告警系统**
- **更复杂 NLP 处理**
- **深度学习异常检测**

🚀 **团队可以根据时间选择扩展功能，我可以提供 Flask 代码模板、数据库初始化脚本等！** 💡