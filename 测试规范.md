# **基于 NLP 的安全日志分析与异常检测 - 测试指导文档**  

本测试文档指导团队如何进行**单元测试、集成测试、功能测试和系统测试**，确保项目稳定性和高质量交付。  

---

## **📌 1. 测试目标**
- 确保各个**API** 功能正常运行  
- 确保**前端 UI** 能正确调用后端 API  
- 确保**异常检测** 能正确识别异常日志  
- 确保**NLP 查询** 能正确转换自然语言为 SQL  
- 确保合并分支后，整个系统可以无误运行  

---

## **📌 2. 每个成员的测试任务**
| **成员** | **测试内容** | **测试方式** |
|----------|------------|--------------|
| **A - 前端开发** | - **UI 渲染**（查询界面、异常日志展示）<br>- **API 调用**（查询日志、异常检测） | - **手动测试**（检查 UI 渲染）<br>- **API 测试**（使用 Postman 调试） |
| **B - 后端开发（API & 数据存储）** | - **数据库 CRUD**（日志存储、查询）<br>- **API 连接测试** | - **Postman / Curl**（直接调用 API）<br>- **单元测试（pytest）** |
| **C1 - 规则匹配异常检测** | - **暴力破解、异常 IP 规则检测** | - **输入不同日志，观察是否正确分类** |
| **C2 - 机器学习异常检测** | - **ML 模型是否正确检测异常** | - **训练集 / 测试集对比，查看准确率** |
| **D - AI/NLP 查询** | - **自然语言转换 SQL**（"最近 24 小时 admin 登录失败次数" → SQL） | - **提供多个 NLP 查询语句，查看 SQL 生成是否正确** |
| **E - 代码集成 & 测试** | - **全系统集成测试**<br>- **分支合并后的功能测试** | - **运行整个 Flask + 前端系统，确保 UI、API、数据库互通** |

---

## **📌 3. 单元测试**
**✅ 目标**：测试各个模块是否**独立**运行正确  
**✅ 适用范围**：
- API 响应是否正确  
- 数据库操作是否正确（日志存储、查询）  
- NLP 查询转换 SQL 是否准确  
- 规则匹配是否正确识别异常  

### **📍 3.1 API 测试**
📌 **测试文件：`tests/test_routes.py`**
```python
import pytest
from app import app

@pytest.fixture
def client():
    app.config["TESTING"] = True
    return app.test_client()

def test_upload_log(client):
    response = client.post("/logs/upload", json={"log_content": "2025-03-24 12:34:56 - User 'admin' login failed from 192.168.1.100"})
    assert response.status_code == 200
    assert response.json["status"] == "success"
```
📌 **运行测试**
```bash
pytest tests/test_routes.py
```

---

## **📌 4. 功能测试**
**✅ 目标**：测试完整的业务流程，确保 API + 前端 + 数据库联通  
**✅ 适用范围**：
- UI 是否能正确展示查询结果  
- NLP 查询输入是否能正确返回 SQL  
- 异常检测模块是否能正确返回异常日志  

📌 **手动测试步骤（适用于前端）**
1. **访问前端页面** `http://127.0.0.1:5000/`
2. **输入自然语言查询** `最近 24 小时 admin 登录失败次数`
3. **检查返回结果**：
   - 是否正确转成 SQL  
   - 是否正确显示日志条目  
4. **上传测试日志**：
   - 运行 `/logs/upload`
   - 在前端查询是否能找到该日志  
5. **异常检测测试**：
   - **手动输入暴力破解日志**，检查系统是否正确标记  

---

## **📌 5. 集成测试**
**✅ 目标**：确保所有模块合并后，仍能正确协作  

### **📍 5.1 主要测试内容**
- **前端 UI + API 交互**
- **API + 数据库交互**
- **NLP 查询转换 + API**
- **异常检测模型 + API**

📌 **测试步骤**
1. 运行 `app.py`，启动 Flask 服务器
2. 打开浏览器，访问 `http://127.0.0.1:5000/`
3. 进行以下操作：
   - 查询日志（SQL 查询 + NLP 查询）
   - 上传日志并验证存储成功
   - 运行异常检测，检查返回的异常数据是否正确
4. 检查前端 UI 是否正确渲染

📌 **出现问题的解决方案**
- **API 返回错误**：使用 Postman 测试，检查请求参数
- **前端未显示数据**：检查浏览器 Console 是否有错误
- **异常检测不准确**：查看数据库是否存入了正确的数据

---

## **📌 6. 分支合并 & 集成测试**
**✅ 目标**：合并多个开发分支后，测试整个系统是否正常运行  

### **📍 6.1 分支合并流程**
1️⃣ **确保 `main` 是最新的**
```bash
git checkout main
git pull origin main
```
2️⃣ **合并你的开发分支**
```bash
git checkout main
git merge feature-log-query
```
3️⃣ **解决冲突**
- Git 提示冲突，手动修改后：
  ```bash
  git add .
  git commit -m "解决合并冲突"
  ```
4️⃣ **运行集成测试**
```bash
pytest tests/
```
如果所有测试通过，推送更新：
```bash
git push origin main
```

---

## **📌 7. 测试计划**
| **时间** | **测试内容** | **测试人员** |
|----------|------------|------------|
| **第 1 周 - 日志管理 API** | 测试日志上传、查询 | B |
| **第 2 周 - 异常检测** | 规则匹配 & 机器学习模型 | C1, C2 |
| **第 2 周 - NLP 查询** | 测试自然语言转 SQL | D |
| **第 2 周 - 前端 UI + API 交互** | 测试 UI 展示、数据交互 | A |
| **第 2 周 - 全系统集成测试** | 运行完整系统，确保所有功能可用 | E |

---

## **📌 8. 结论**
✅ **所有成员都有明确的测试任务**，避免遗漏问题  
✅ **Git 分支合并后，必须进行集成测试**，确保不会破坏主代码  
✅ **使用 Pytest 自动化测试，减少手动测试工作量**  

🚀 **如果团队确认方向，我可以提供更详细的 Pytest 自动化测试代码！** 💡